<!DOCTYPE html><!--
	Copyright (c) 2014-2022, CKSource Holding sp. z o.o. All rights reserved.
	This file is licensed under the terms of the MIT License (see LICENSE.md).
-->

<html lang="en" dir="ltr">
	<head>
		<title>CKEditor 5 ClassicEditor build</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" type="image/png" href="https://c.cksource.com/a/1/logos/ckeditor5.png">
		<link rel="stylesheet" type="text/css" href="styles.css">
	</head>
	<body data-editor="ClassicEditor" data-collaboration="false" data-revision-history="false">
		<div class="editor"></div>
		<script src="https://topz.com.vn/assets/js/jquery.min.js?v=0.38"></script>
		<script src="../build/ckeditor.js"></script>
		<style>
			#lock-box {
				pointer-events: none;
				user-select: none;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
			}
			.lock-box {
				border: 2px solid #f7c139;
				display: block;
				width: 100%;
				padding: 2px;
				margin: 5px 0;
			}
			body {
				position: relative;
			}
			.popup_edit {
				position: absolute;
				width: 300px;
				background-color: #fff;
				z-index: 9999;
				box-shadow: 0 1px 2px 1px rgba(0,0,0,0.2);
				border-radius: 3px;
				padding: 3px;
				display: none;
			}
			.popup_edit .action {
				display: flex;
				align-items: center;
				justify-content: space-between
			}
			.popup_edit .action p {
				margin-top: 0;
				margin-bottom: 0;
				cursor: pointer;
			}
			.popup_edit input {
				width: 100%;
				overflow: hidden;
			}
			.popup {
				position: fixed;
				width: 100%;
				top: 0;
				bottom: 0;
				left: 0;
				right: 0;
				height: 100%;
				background-color: rgba(0,0,0,0.7);
				display: flex;
				align-items: center;
				justify-content: center;
				opacity: 0;
				visibility: hidden;
			}
			.popup.active {
				opacity: 1;
				visibility: visible;
				z-index: 999;
			}
			.popup_body {
				width: 400px;
				background-color: #fff;
				border-radius: 10px;
				padding: 15px;
			}
			.popup_title p {
				font-size: 18px;
				text-align: center;
				color: #000;
				margin: 0 0 15px;
			}
			.popup_content textarea {
				width: 100%;
				border-radius: 5px;
			}
			.popup_action {
				display: flex;
				align-items: center;
				justify-content: flex-end;
			}
			.popup_action_update,
			.popup_action_accept {
				background-color: aqua;
				width: 50px;
				height: 30px;
				margin-right: 15px;
				cursor: pointer;
				text-align: center;
				line-height: 30px;
				color: #fff;
			}
			.popup_action_update {
				display: none;
			}
			.popup_action_cancel {
				background-color: #c00;
				width: 50px;
				height: 30px;
				margin-right: 15px;
				cursor: pointer;
				text-align: center;
				line-height: 30px;
				color: #fff;
			}
			.popup_action.edit .popup_action_accept {
				display: none;
			}
			.popup_action.edit .popup_action_update {
				display: inline-block;
			}
			.button_action_insert svg {
				height: 8px;
				margin-top: 1px;
				transform: rotate(90deg);
				transition: transform .5s ease;
				width: 10px;	
			}
			.button_action_insert button{
				width: 25px;
				height: 25px;
				border-radius: 50%;
				border: 0;
				cursor: pointer;
				display: none;
				position: absolute;
			}
			.button_action_insert.active button {
				display: block;
				z-index: 9999;
			}
			.button_action_insert button:hover {
				background-color: #5f93ef;
			}
			.button_action_insert button:hover svg path {
				fill: #fff
			}
		</style>
		<script>
			const customImage = () => {
				window.editor.model.change( writer => {
                    const imageElement = writer.createElement( 'imageBlock', {
                        src: 'https://cdn.topz.vn/topz/2022/06/truyen-ngon-tinh-dai-thuc-loli-2.jpg'
                    } );

                    // Insert the image in the current selection location.
                    editor.model.insertContent( imageElement, window.editor.model.document.selection );
                } );
			}
			// function Ck toc tham khảo admin.topz
			const CKToc  = () => {
				console.log('Init cktoc success')
			}
			// function HighLight tham khảo admin.topz
			const HighLight  = () => {
				$('.popup.highlight').addClass('active')
			}
			// function BestOffer tham khảo admin.topz
			const BestOffer  = () => {
				console.log('Init BestOffer success')
			}
			console.log(ClassicEditor.defaultConfig.toolbar.items);
			ClassicEditor
				.create( document.querySelector( '.editor' ), {
					toolbar: {
						'items' : [
							...ClassicEditor.defaultConfig.toolbar.items,
							'|',
							'auto_content_write',
							'auto_content_rewrite',
							'auto_content_describe',
							// 'restrictedEditing'
						],
						shouldNotGroupWhenFull: true,
					},
	                heading: {
	                    options: [
	                        { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
	                        { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
	                        { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
	                        { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' },
	                        { model: 'heading4', view: 'h4', title: 'Heading 4', class: 'ck-heading_heading4' },
	                        { model: 'heading5', view: 'h5', title: 'Heading 5', class: 'ck-heading_heading5' },
	                        { model: 'heading6', view: 'h6', title: 'Heading 6', class: 'ck-heading_heading6' },
	                    ]
	                },
	                dnvImage: customImage,
					dnvCKToc: CKToc,
					dnvHighLight: HighLight,
					dnvBestOffer: BestOffer,
					inlineStyles: true,
					// add config link a
					link: {
						decorators: {
							openInNewTab: {
								mode: 'manual',
								label: 'Open in a new tab',
								attributes: {
									target: '_blank',
								}
							},
							noFolllow: {
								mode: 'manual',
								label: 'Nofollow',
								attributes: {
									rel: 'nofollow'
								}
							}
						}
					}
	            })
				.then( editor => {
					window.editor = editor;
				} )
				.catch( error => {
					console.warn( 'Init ckeditor error' );
                	console.error( error );
				} );
				var selectionItem = ''
				$('body').on('click', '.lock-box', function(e){
					let clientX = e.originalEvent.clientX
					let clientY = e.originalEvent.clientY
					// window.editor.enableReadOnlyMode('chanhLink');
					selectionItem = $(this).attr('id')
					const element = document.querySelector('#'+selectionItem)
					const rect = element.getBoundingClientRect();
					const container = document.querySelector('body');
					const containerRect = container.getBoundingClientRect();
					const containerScrollTop = container.scrollTop;
					const bottom = rect.bottom + containerScrollTop - containerRect.top;
					$('.popup_edit input').val($(this).text())
					$('.popup_edit').css({
						'display': 'block',
						'top': bottom + 20,
						'left': (rect.width / 2) - 100
					})
				})
				$('body').on('click', '.popup_action_accept', function(e){
					let txt = $('.popup textarea').val()
					$('.popup').removeClass('active')
					
					window.editor.model.change(writer => {
						const lockBoxElement = writer.createElement("lock-box", {
							type: "highlight",
							content: txt
						});
						window.editor.model.insertContent(lockBoxElement);
					});
				})
				$('body').on('click', '.popup_action_update', function(e){
					let txt = $('.popup textarea').val()
					let id = 'box-' + new Date().getTime()
					let html = `<code class="lock-box ck-widget lock-box" id="${id}" contenteditable="false">[content="${txt}"]</code>`
					let viewFragment = window.editor.data.processor.toView(html);
					let modelFragment = window.editor.data.toModel(viewFragment);
					window.editor.model.insertContent(modelFragment, window.editor.model.document.selection);
					const widgetElement = window.editor.editing.view.domRoots
						.get("main")
						.querySelector(`#${id}`);
					widgetElement.setAttribute("contenteditable", false);
					let index_id = selectionItem;
					let new_data = $('<div></div>');
					new_data.append($('.ck-restricted-editing_mode_standard').html());
					$(new_data).find('#' + index_id).remove();
					html = new_data[0].innerHTML;
					window.editor.execute('selectAll');
					window.editor.setData(html);
					$('.popup_action').removeClass('edit')
					$('.popup').removeClass('active')
				})
				$('body').on('click', '.popup_action_cancel', function(e){
					$('.popup_action').removeClass('edit')
					$('.popup').removeClass('active')
				})
				$('body').on('click', '.popup_edit .action .cancel', function(e){
					$('.popup_edit').css('display', 'none')
				})
				$('body').on('click', '.popup_edit .action .edit', function(e){
					let txt = $(this).closest('.popup_edit').find('input').val()
					txt = txt.replace('[', '').replace(']', '')
					$('.popup_content textarea').val(txt)
					$('.popup_edit').css('display', 'none')
					$('.popup_action').toggleClass('edit')
					$('.popup').addClass('active')
				})
		</script>
	</body>
	<div class="popup_edit">
		<input type="text">
		<div class="action">
			<p class="edit">edit</p>
			<p class="cancel">cancel</p>
		</div>
	</div>
	<div class="popup highlight">
		<div class="popup_body">
			<div class="popup_title">
				<p>Vùng nổi bật</p>
			</div>
			<div class="popup_content">
				<textarea name="content" id="" cols="30" rows="10"></textarea>
			</div>
			<div class="popup_action">
				<p class="popup_action_accept">Xong</p>
				<p class="popup_action_update">Cập nhật</p>
				<p class="popup_action_cancel">Hủy</p>
			</div>
		</div>
	</div>
</html>